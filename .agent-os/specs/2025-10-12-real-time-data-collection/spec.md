# Spec Requirements Document

> Spec: 实时数据采集服务
> Created: 2025-10-12

## Overview

实现多协程实时数据采集服务，支持100+交易对的高频数据采集，实时计算价格变化率，并将数据写入Redis缓存和PostgreSQL数据库。该服务将作为整个系统的数据源，为前端实时监控和策略分析提供可靠的数据基础。

## User Stories

### 实时数据采集

作为系统管理员，我希望系统能够自动采集多个交易对的实时价格数据，以便为交易信号分析提供数据基础。

**详细工作流程：**
1. 系统启动时自动连接BitGet WebSocket API
2. 批量订阅100+个活跃交易对的价格数据
3. 实时接收价格更新并计算变化率
4. 将实时数据写入Redis缓存供前端查询
5. 异步将历史数据持久化到PostgreSQL
6. 监控数据采集状态和连接健康度

### 价格变化率计算

作为交易分析师，我希望系统能够实时计算不同时间窗口的价格变化率，以便快速识别异常波动。

**详细工作流程：**
1. 系统接收实时价格数据
2. 计算1分钟、5分钟、15分钟窗口的价格变化率
3. 与历史数据对比识别异常波动
4. 将计算结果存储到缓存中
5. 为符合条件的交易对生成告警信号

### 数据采集监控

作为系统运维人员，我希望能够监控数据采集服务的运行状态，以便及时发现和解决问题。

**详细工作流程：**
1. 实时监控WebSocket连接状态
2. 统计数据采集成功率和延迟
3. 记录错误日志和异常情况
4. 提供健康检查接口
5. 自动重连和故障恢复

## Spec Scope

1. **多协程数据采集** - 实现支持100+交易对的高并发数据采集服务
2. **实时价格变化率计算** - 计算1m、5m、15m时间窗口的价格变化率
3. **Redis缓存写入** - 将实时数据高效写入Redis缓存供前端查询
4. **异步数据持久化** - 将历史数据异步写入PostgreSQL数据库
5. **数据采集监控** - 实现采集状态监控、日志记录和健康检查
6. **自动重连机制** - 实现WebSocket连接断开时的自动重连

## Out of Scope

- 数据清洗和异常值处理（后续版本实现）
- 多交易所数据聚合（仅支持BitGet）
- 实时数据流式处理（使用批处理方式）
- 数据质量评估和告警（基础版本不包含）

## Expected Deliverable

1. 数据采集服务能够稳定运行，支持100+交易对同时采集
2. 实时价格变化率计算准确，延迟小于100ms
3. Redis缓存数据更新及时，前端能够实时获取最新价格
4. 历史数据正确持久化到PostgreSQL，支持后续查询
5. 监控和日志系统完整，能够及时发现和定位问题
6. 服务具备自动恢复能力，网络中断后能够自动重连
